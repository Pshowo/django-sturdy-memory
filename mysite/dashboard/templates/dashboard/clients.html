{% extends "dashboard/index.html" %}
{% block content %}
    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
        <div class='row'>
            <ul class="nav">
                <li class="nav-item">
                  <a class="nav-link active" aria-current="page" href="#">Clients list</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'dashboard-new_client' %}">New client</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#">Edit</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
                </li>
              </ul>
        </div>
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h2 class="h2">Clients</h2>
        </div>

        <div class="table-responsive">
            <table class="table table-striped table-hover table-sm">
              <thead>
                <tr>
                  <th scope="col-2">#</th>
                  <th scope="col">Name</th>
                  <th scope="col">Country</th>
                  <th scope="col">City</th>
                  <th scope="col">Program</th>
                  <th scope="col">CPU</th>
                  <th scope="col">RAM</th>
                </tr>
              </thead>
              <tbody>
                {% for client in clients %}
                
                <tr>
                  <th scope='row'>{{ client.id }}</th>
                  <td><span  id="dot_{{client.id}}" class="dot"></span>  <a href="{{ client.id }}">{{ client.name }}</a></td>
                  <td>{{ client.country }}</td>
                  <td>{{ client.city }}</td>
                  <td>Program name</td>
                  <td id="cpu_{{client.id}}"> %</td>
                  <td id="ram_{{client.id}}"> %</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
    </main>
<script type="text/javascript">

  setInterval(function(){
    console.log("Interval function")
    fetch('http://127.0.0.1:80/dashboard/api/test/')
    .then(response => response.json())
    .then(data => data.clients.forEach(client=>
    {
      $(`#cpu_${client.id}`).html(`${client.CPU} %`)
      $(`#ram_${client.id}`).html(`${client.RAM_PER} %`)
      if (client.is_active == true){
        $(`#dot_${client.id}`).addClass("dotgreen");
      }
      else{
        $(`#dot_${client.id}`).removeClass("dotgreen");
      }
    }))
    
  }, 3000);

</script>
{% endblock %}

//